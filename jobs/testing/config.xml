<?xml version='1.0' encoding='UTF-8'?>
<flow-definition plugin="workflow-job@2.9">
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <org.jenkinsci.plugins.workflow.job.properties.PipelineTriggersJobProperty>
      <triggers/>
    </org.jenkinsci.plugins.workflow.job.properties.PipelineTriggersJobProperty>
  </properties>
  <definition class="org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition" plugin="workflow-cps@2.23">
    <script>node {
    wrap([$class: &apos;TimestamperBuildWrapper&apos;]) {
        timeout(time: 12, unit: &apos;HOURS&apos;) {
            stage(&apos;Cleanup&apos;) {
                deleteDir()
            }
            ws {
                dir(&apos;site&apos;) {
                    stage(&apos;Checkout site.conf&apos;) {
                        //checkout([$class: &apos;GitSCM&apos;, userRemoteConfigs: [[url: &apos;https://github.com/chris1911/site-ffka&apos;]], branches: [[name: &apos;refs/tags/v0.2.90-stable.1&apos;]]])
                        checkout([$class: &apos;GitSCM&apos;, userRemoteConfigs: [[url: &apos;https://github.com/chris1911/site-ffka&apos;]], branches: [[name: &apos;master&apos;]]])
                    }

                    env.gluonBranch = sh([returnStdout: true, script: &apos;make -f jenkins.mk gluonbranch&apos;])
                }
                
                dir(&apos;ffka&apos;) {
                    stage(&apos;Checkout gluon&apos;) {
                        def branchName = &apos;refs/tags/&apos; + env.gluonBranch
                        checkout([$class: &apos;GitSCM&apos;, userRemoteConfigs: [[url: &apos;https://github.com/freifunk-gluon/gluon&apos;]], branches: [[name: branchName]]])
                        sh &quot;ln -s ../site ./site&quot;
                    }
                    
                    stage(&apos;Update sub projects&apos;) {
                        sh &quot;make update&quot;
                    }
        
                    stage(&apos;Build ar71xx-generic&apos;) {
                        // todo: read enabled targets from gluon/targets/targets.mk
                        sh &quot;make -j \$(nproc) GLUON_TARGET=ar71xx-generic clean&quot;
                        sh &quot;make -j \$(nproc) GLUON_TARGET=ar71xx-generic&quot;
                    }
                }
            }
        }
    }
}</script>
    <sandbox>true</sandbox>
  </definition>
  <triggers/>
</flow-definition>